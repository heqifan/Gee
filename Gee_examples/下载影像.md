```python
import ee
import geemap
import os
from concurrent.futures.thread import ThreadPoolExecutor
```

////////导入需要的包，其中from concurrent.futures.thread import ThreadPoolExecutor 可以使电脑运行速度开发到最大，使得效率最大化！！！以后都可以类似的这么做！！/////////

```python
Map = geemap.Map()
Map
```



```python
roi = Map.draw_last_feature.geometry()
```

///////////   1.在运行这一步前要先画图，其实类似的可以不用自己画，

![image-20210802210024959](C:\Users\树风\AppData\Roaming\Typora\typora-user-images\image-20210802210024959.png)

有很多方法形成区域，比如json_to_ee , shp_to_ee,excel_to_ee(我先只知道这么多，以后知道了再添加)

2.得到区域/////////

```python
class para:
    start_time = '2001-05' # 开始时间
    end_time = '2001-07'   # 结束时间
    outpath = 'E:/temp/Shandong'
    outpath = 'F:/文件/工作/孟印缅边界/MOD11A2/'   # 下载文件保存文件夹路径,路径符号用正斜杠，且以正斜杠结尾
    file_format = '.tif'         # 下载文件保存格式
```

/////////这里用了[python面向对象的语法](https://www.runoob.com/python/python-object.html)，有点难，这里就不解释了，反正意思就是先定义好一个模板，里面存放着变量集，比较有条理的亚子。///////

```python
if not os.path.exists(para.outpath1):
    os.makedirs(para.outpath)
```

//////  1.这里给了创建文件夹的方式，优点就是既可以用原来的文件夹，又可以现在新建文件夹，且新建文件夹不用手动添加，直接输入路径就行，直接一举两得。

2.建立下载路径///////

```python
images = ee.ImageCollection("MODIS/006/MOD11A2").filterDate(para.start_time, para.end_time) # 引用方法到gee里面复制
```


```python
# filterDate确定时间范围
name = images.aggregate_array('system:id').getInfo()   # 得到地图id
```

//////这里为什么要用到[images.aggregate_array('system:id').getInfo()](https://developers.google.com/earth-engine/apidocs/ee-imagecollection-aggregate_array)这个东西

呢？关于上述函数的详细说明点击上面就行，简单来说就是将 'system:id' 这些属性转变为列表，便于输出出来。

上述例子是图像集，所以列表里面存放了多个单个图像的id：![image-20210802205924826](C:\Users\树风\AppData\Roaming\Typora\typora-user-images\image-20210802205924826.png)

若是图像的话，就只有一个id//////

```python
def dow(i):
    Layer = ee.Image(i).select('LST_Day_1km') # 使用地图，select为确定地图波段，可以去除，则为全波段
    # 保存文件名为地图id加文件格式
    a = i.split('/')
    str = '-'
    b = str.join(a)
    file = para.outpath + b + para.file_format
    # 导出栅格影像，file_per_band为是否按波段分别导出
    geemap.ee_export_image(Layer, filename=file, scale=1000, region=roi,file_per_band=True)
```

//////////  1.这里用了python 里的定义函数

2.在 ee.Image(i).select('LST_Day_1km')之前，我们应该要先查看图像的波段名称，在此文件夹下的  获取图像信息和元数据  中有怎么查看波段的名称的方法。

3.如下代码将字符串的分隔符号进行替换，用的是split()和

join()函数，这两个函数结合一起用就是替换分隔符号

4.至于为什么要替换呢？因为上述路径的分隔符号也是用的 "/",如果不替换的话就会弄混，但是也可以把路径的分隔符号用 " \ " 来代替，不过这时要在前面加上 r (防止转义)

```python
a = i.split('/')
str = '-'
b = str.join(a)
file = para.outpath + b + para.file_format
```

```python
with ThreadPoolExecutor(max_workers=10) as executor:
    executor.map(dow, name)
```

////////最大线程为10，异步下载提升效率

最后：这里下载的路径是D盘，因为文件不怎么大，如果很大的话，可以下载到google云盘，下次我再说。

