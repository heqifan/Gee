```python
# 导入需要提取的图像

MOD13 = ee.ImageCollection('MODIS/006/MOD13A2') .filterDate('2018-01', '2018-02').first().select('NDVI')

Map.addLayer(MOD13, {}, 'MOD13')
```

//////////  1.first() 的意思是提取图像集的第一张图

2.select('NDVI')的意思是提取那张图波段为'NDVI'的影像//////

```python
# 将上述点集合并为要素集
temp_point = ee.FeatureCollection(Map.draw_features)
temp_point.getInfo()

```

/////////  1.在运行这一步之前要打点，并且要故意打几个点到图像外面，造成缺失值的问题//////////

![image-20210803162343874](C:\Users\树风\AppData\Roaming\Typora\typora-user-images\image-20210803162343874.png)

![image-20210110124024053](https://camo.githubusercontent.com/acb3b45f3861868f40f066ea61a4edd9a59676bf35e6b3fc7762988f479b9aeb/68747470733a2f2f696d67323032302e636e626c6f67732e636f6d2f626c6f672f323231333636302f3230323130312f323231333636302d32303231303131303132343032353031302d3737353833393932392e706e67)

```python
# 点值提取
temp = MOD13.sampleRegions(temp_point, geometries=True)
temp.getInfo()

```

![image-20210803162719026](C:\Users\树风\AppData\Roaming\Typora\typora-user-images\image-20210803162719026.png)

//////////  1.MOD13.sampleRegions的具体含义请参见[ee.Image.sampleRegions](https://developers.google.com/earth-engine/apidocs/ee-image-sampleregions?hl=en)，其实简单来讲就是在图层上取与上述打的点相同位置的像素，并转化为要素，集合起来就是要素集。但是上面也说了，有些点是不在图层里的，所以只有在图层里的才会被转化。////////////

```python
# 将要提取的值设置为一个属性，并填充为-9999

def setNDVI(feature):
    return feature.set('NDVI', -9999)
temp_point1 = temp_point.map(setNDVI)
temp_point1.getInfo()
```

![image-20210110124202962](https://camo.githubusercontent.com/2a6da628ff0bc9d443ac1dc0f0d57b9a713a2abef486bdd8d56cd64d0439ea1a/68747470733a2f2f696d67323032302e636e626c6f67732e636f6d2f626c6f672f323231333636302f3230323130312f323231333636302d32303231303131303132343230333739302d3438333230373838302e706e67)

/////////这里为什么要设无效值呢？？嗯，其实原因就是，上面说了有些点是不在图层上的，但是我们还是要用到这些点，因为这些点可以看做是台站，是必要的，我们先在这里设无效值，下面会将他们合并，后续就是处理无效值的工作了，有**拉格朗日插值法、分段插值法、样条插值法**。

```python
# 修改点值提取后的要素集的id
temp1 = ee.List([])
def setID1(feature, List):
    feature1 = feature.set('system:index', ee.String(feature.get('system:index')).split('_').get(0))
    return ee.List(List).add(feature1)
temp2 = ee.FeatureCollection(ee.List(temp.iterate(setID1, temp1)))
temp2.getInfo()

```

////////////1.这里将'system:index'的id改了名字，因为这里的ID的名称与后面要匹配的id不一样，所以要进行变换，不然后面没法匹配。

2.这里用了 set （）函数，意为 更改。

还用了get（）函数，意为获取数据。

还用了ee.String（）函数，意为将变量转换为字符串。

最最重要的还是iterate（）列表递归函数，具体详解请参考

[ee.List.iterate](https://developers.google.com/earth-engine/apidocs/ee-list-iterate?hl=en)，简单来说就是将列表放将函数里面循环处理，这样就将循环给替代掉了，所以递归加函数等于循环。///////////////

![image-20210110124235491](https://camo.githubusercontent.com/a214e94d99f6b08ca42aa156f4be746176b21c6eab4507123da73b21b5a3aa2a/68747470733a2f2f696d67323032302e636e626c6f67732e636f6d2f626c6f672f323231333636302f3230323130312f323231333636302d32303231303131303132343233363330312d3939323837363736312e706e67)

```python
# 筛选空值

filter = ee.Filter.equals(
  leftField='system:index',
  rightField='system:index'
)
simpleJoin = ee.Join.inverted()
simpleJoined = simpleJoin.apply(temp_point1, temp2, filter)

simpleJoined.getInfo()
```

///////////1.这里用了ee.Filter.equals(）这个函数，具体请详见

[ee.Filter.equals](https://developers.google.com/earth-engine/apidocs/ee-filter-equals?hl=en)，但是好难看懂，简单来说就是定义将要进行比较的属性，左边要比较的属性是啥，右边要比较的属性是啥。

2.还用了 [ee.Join.inverted()](https://developers.google.com/earth-engine/apidocs/ee-join-inverted?hl=en)，简单来说就是连接生成主集合中不匹配辅助集合元素的元素。

3.还用了[ee.Join.apply](https://developers.google.com/earth-engine/apidocs/ee-join-apply?hl=en)，简单来说就是在上述的操作上加上过滤器,也就是上述的Filter.equals()。//////////

![image-20210110124408934](https://camo.githubusercontent.com/4b195460fdb237446ce4032436fc78fa5a2db9884755f2f50a29f0e133b38a16/68747470733a2f2f696d67323032302e636e626c6f67732e636f6d2f626c6f672f323231333636302f3230323130312f323231333636302d32303231303131303132343430393833382d3534353336333732362e706e67)

```python
# 合并要素集

temp3 = temp2.merge(simpleJoined)
temp3.getInfo()
```

/////////1.这里用了[ee.FeatureCollection.merge](https://developers.google.com/earth-engine/apidocs/ee-featurecollection-merge?hl=en)函数，简单来说就是将两个集合合并为一个集合。结果包含任意一个集合中的所有元素。其中合并之后第一个集合中的元素的id将以“1_”为前缀，第二个集合中的元素的id将以“2_”为前缀。

这位下面改名垫下了伏笔。

/////////

![image-20210110124541835](https://camo.githubusercontent.com/3555f380de8c7eb2ff35ca85792d258a93289f4daab14f2cbc199c64e29ca2fd/68747470733a2f2f696d67323032302e636e626c6f67732e636f6d2f626c6f672f323231333636302f3230323130312f323231333636302d32303231303131303132343534323634332d313933363233363930382e706e67)

![image-20210110124551505](https://camo.githubusercontent.com/366fb5ecbc6efc77930a1f00ef57fb87cf797ed0c0c246ba6f9a588c1e8e1ea9/68747470733a2f2f696d67323032302e636e626c6f67732e636f6d2f626c6f672f323231333636302f3230323130312f323231333636302d32303231303131303132343535323237372d3431363033383530302e706e67)

```python
temp4 = ee.List([])
def setID2(feature, List):
    feature1 = feature.set('system:index', ee.String(feature.get('system:index')).split('_').get(-1))
    return ee.List(List).add(feature1)
temp5 = ee.FeatureCollection(ee.List(temp3.iterate(setID2, temp1))).sort('system:index')
temp5.getInfo()

```

//////////1.v修改id来重新排序。其中[sort()](https://developers.google.com/earth-engine/apidocs/ee-featurecollection-sort?hl=en)简单来说就是排序，默认为升序排序。/////////

学习到了：1.点值提取  2.点集合合并为要素集  3.设置属性并填充  4.修改ID 5.筛选空值 6.合并要素集





