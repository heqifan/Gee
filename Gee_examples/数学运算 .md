# Mathematical Operations

图像运算可以使用add()和subtract()等操作符执行，但是对于包含多个术语的复杂计算，expression()函数提供了一个很好的替代方法。



## 运算符：

数学运算符对图像波段进行基本的算术运算。它们有两个输入:两个图像或一个图像和一个常数项，这个常数项被解释为没有掩码像素的单波段常数图像。对于每个波段，每个像素执行操作。

举一个简单的例子，考虑使用Landsat图像计算归一化植被指数(NDVI)的任务，其中使用了add()， subtract()， divide()算法:

```python
# Load a 5-year Landsat 7 composite 1999-2003.
landsat_1999 = ee.Image('LANDSAT/LE7_TOA_5YEAR/1999_2003')

# Compute NDVI.
ndvi_1999 = (landsat_1999.select('B4').subtract(landsat_1999.select('B3'))
             .divide(landsat_1999.select('B4').add(landsat_1999.select('B3'))))
```

只有两个输入之间的未掩膜像素的交集被认为是未掩膜的，所有其他的都是掩膜的。一般来说，如果任一输入只有一个波段，那么它就被用于其他输入的所有波段。如果输入具有相同数量的波段，但名称不同，则按自然顺序成对使用。在第一个输入顺序中，输出波段以两个输入中较长的波段命名，或者如果它们的长度相等。输出像素的类型是输入类型的并集。

下面的多波段图像减法示例演示了如何自动匹配波段，从而为每个共存波段的每个像素生成一个“变化向量”。

```python
# Load a 5-year Landsat 7 composite 2008-2012.
landsat_2008 = ee.Image('LANDSAT/LE7_TOA_5YEAR/2008_2012')

# Compute multi-band difference between the 2008-2012 composite and the
# previously loaded 1999-2003 composite.
diff = landsat_2008.subtract(landsat_1999)

# Compute the squared difference in each band.
squared_difference = diff.pow(2)

# Define a map centered on Australia.
map_diff = folium.Map(location=[-24.003, 133.565], zoom_start=5)

# Add the image layers to the map and display it.
map_diff.add_ee_layer(diff,
                   {'bands': ['B4', 'B3', 'B2'], 'min': -32, 'max': 32},
                   'diff.')
map_diff.add_ee_layer(squared_difference,
                   {'bands': ['B4', 'B3', 'B2'], 'max': 1000},
                   'squared diff.')
display(map_diff.add_child(folium.LayerControl()))
```

在本例的第二部分中，使用image.pow(2)计算平方差。有关处理基本算术、三角、求幂、舍入、转换、位运算等的数学运算符的完整列表，请参阅[API文档](https://developers.google.com/earth-engine/apidocs)。

## 表达式：

要实现更复杂的数学表达式，可以考虑使用image.expression()，它解析数学操作的文本表示。下面的例子使用expression()来计算Enhanced Vegetation Index (EVI):

```python
# Load a Landsat 8 image.
image = ee.Image('LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318')

# Compute the EVI using an expression.
evi = image.expression(
    '2.5 * ((NIR - RED) / (NIR + 6 * RED - 7.5 * BLUE + 1))', {
        'NIR': image.select('B5'),
        'RED': image.select('B4'),
        'BLUE': image.select('B2')
    })

# Define a map centered on San Francisco Bay.
map_evi = folium.Map(location=[37.4675, -122.1363], zoom_start=9)

# Add the image layer to the map and display it.
map_evi.add_ee_layer(
    evi, {'min': -1, 'max': 1, 'palette': ['FF0000', '00FF00']}, 'evi')
display(map_evi)
```



注意expression()的第一个参数是数学操作的文本表示，第二个参数是一个字典，其中键是表达式中使用的变量名，值是应该映射到的变量的图像带。图像中的波段可以被称为b(“波段名称”)或b(索引)，例如b(0)，而不是提供字典。当使用频带映射字典时，频带可以从输入以外的图像定义。注意，expression()使用了"floor division"，它丢弃余数，当两个整数时返回一个整数

![image-20210802155747769](C:\Users\树风\AppData\Roaming\Typora\typora-user-images\image-20210802155747769.png)

## 学到了：

​			1.基本运算符：算术运算符，关系运算符，逻辑运算符，条件运算符。

​			2.表达式的写法

​			3.NDVI，EVI的算法

```python
# Compute NDVI.
ndvi_1999 = (landsat_1999.select('B4').subtract(landsat_1999.select('B3'))
```

```python
# Load a Landsat 8 image.
evi = image.expression(
    '2.5 * ((NIR - RED) / (NIR + 6 * RED - 7.5 * BLUE + 1))', {
        'NIR': image.select('B5'),
        'RED': image.select('B4'),
        'BLUE': image.select('B2')
    })
```

