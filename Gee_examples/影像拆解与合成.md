

影像合成与分解

复合年内和年际日期范围，以减少图像的数量，提高质量。例如，假设您要创建非洲年度NDVI的可视化。一种选择是简单地过滤MODIS 16天NDVI收集，包括所有2018年的观测数据。

```python
var ndviCol = ee.ImageCollection('MODIS/006/MOD13A2')
  .filterDate('2018-01-01', '2019-01-01')
  .select('NDVI')
```

年际复合经过滤而减少

上述集合的可视化显示，在云层覆盖较重的森林区域有相当大的噪声(图2a)。通过在MODIS收集的所有年份中以中位数减少连续日期范围，可以获得更好的表现。

如下：

```python
#定义一个列表，放着开始的时间
doyList = ee.List.sequence(1, 365, 16)
#选择图像集的特定波段
var ndviCol = ee.ImageCollection('MODIS/006/MOD13A2').select('NDVI')
#定义函数，将列表的每个元素都依次放入函数，使得每十五天都取个中值，使得值更加精确
def lm(startDoy) :
	startDoy = ee.Number(startDoy) 
 	return ndviCol
    .filter(ee.Filter.calendarRange(startDoy, startDoy.add(15), 'day_of_year'))
    .reduce(ee.Reducer.median())
#map()：映射函数
ndviCompList = doyList.map(lm)
#将图像列表转换为图像集
ndviCompCol = ee.ImageCollection.fromImages(ndviCompList)
```

这个集合产生的动画噪声较小，因为每幅图像代表了20多年数据的16天NDVI合成的中值(图1b)。

![img](https://developers.google.com/earth-engine/images/ImageCollection_video_africa_no_composite.gif)

![img](https://developers.google.com/earth-engine/images/ImageCollection_video_africa_composite.gif)

年度内的综合由过滤和减少

前面的例子适用于年际合成。它也有助于合成一系列的年内观测数据。例如，每个传感器每16天收集一次特定场景的陆地卫星数据，但经常有一部分图像被云层遮挡。遮蔽云层，合成同一季节的几张图片，可以产生一个更无云的表现。考虑下面的例子，7月和8月的Landsat 5图像是使用1985年到2011年每年的中位数合成的。

```javascript

var lsCol = ee.ImageCollection('LANDSAT/LT05/C01/T1_SR')
  .filterBounds(ee.Geometry.Point(-122.9, 43.6))
  .filter(ee.Filter.dayOfYear(182, 243))
 //将观测年份作为属性添加到每张图像中。
  .map(function(img) {
    return img.set('year', ee.Image(img).date().get('year'));
  });

// 定义一个函数来遮罩图像的云和阴影。
var cloudMask = function(img) {
  var qa = img.select('pixel_qa');
  var cloud = qa.bitwiseAnd(1 << 5).or(qa.bitwiseAnd(1 << 3));
  return img.updateMask(cloud.not());
};

// 从图像收集中定义一个独特的观测年份列表。
var years = ee.List(lsCol.aggregate_array('year')).distinct().sort();

// 地图上的年份，以建立一个列表的年度图像复合。
var lsCompList = years.map(function(year) {
  return lsCol
    // 过滤图像采集按年进行。
    .filterMetadata('year', 'equals', year)
    // 应用云掩膜
    .map(cloudMask)
    // 通过中值减少图像采集。
    .reduce(ee.Reducer.median())
    // 将合成年份设置为图像属性。
    .set('year', year);
});

// 将图像列表转换为ImageCollection。
var lsCompCol = ee.ImageCollection.fromImages(lsCompList);
```