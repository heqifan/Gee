要求1：

数据：获取LandSat5 或 LandSat7、L8的地表反射率数据   时间：2003年的3~9月  范围：鄱阳湖

```python
import geemap
import ee
Map = geemap.Map()
Map
roi = ee.FeatureCollection("users/yehuigeo/poyanghu")
dataset_rgb = ee.ImageCollection("LANDSAT/LT05/C01/T1_TOA").filterDate('2003-03-01', '2003-09-30')
```



要求2：

定义去云函数；对影像QA波段进行去云

```python
def maskL8srgb(dataset_kec):                                      #去云
    # 第3位和第5位分别是云阴影和云。
    cloudShadowBitMask = (1 << 3)
    cloudsBitMask = (1 << 5)
    #获得像素QA波段。
    qa = dataset_kec.select('BQA')
    #这两个标志都应该设置为零，表示明确的条件。
    mask = qa.bitwiseAnd(cloudShadowBitMask).eq(0) .And(qa.bitwiseAnd(cloudsBitMask).eq(0)) 
    return dataset_kec.updateMask(mask)

dataset_rgb =  dataset_rgb.map(maskL8srgb)  #对影像集进行掩膜
```



要求3：

通过波段组合得到EVI、MNDWI、NDVI三种水体指数

```python
def normalizedDifference1(image):
    mndwi = image.normalizedDifference(['B3','B6']).clip(table).rename('MNDWI')
    return mndwi.updateMask( mndwi.gt(-1).And( mndwi.lt(1)))
#MNDWI指数的计算
def normalizedDifference2(image):
    evi = image.expression(
          '2.5*(NIR-RED)/(NIR+6*RED-7.5*BLUE+1)',{
          'NIR':image.select('B4'),
          'RED':image.select('B3'),
          'BLUE':image.select('B1')
        }).clip(table).rename('EVI')
    return evi.updateMask(evi.gt(-1).And(evi.lt(1)))
#EVI指数的计算
def normalizedDifference3(image):
ndvi = image.normalizedDifference(['B3','B4']).clip(table).rename('NDVI')
    return ndvi.updateMask(ndvi.gt(-1).And(ndvi.lt(1)))
#NDVI指数的计算
```



要求4：

定义函数将三种水体指数进行合并，成为一个三波段的图像

```python
def collection(image):
    mndwi = normalizedDifference1(image)
    evi = normalizedDifference2(image)
    ndvi = normalizedDifference3(image)
    return image.addBands(mndwi).addBands(evi).addBands(ndvi)

```

```python
add_bands = dataset_rgb.map(collection) 
#添加MNDWI,NDVI,EVI的波段
```

检查组合成新图像的波段数目

```python
add_bands.first().bandNames().getInfo()
```



要求5：定义符合 MNDWI > NDVI或MNDWI > EVI 和 EVI < 0.1的为有水的像元（下面通称水像元），不符合的为其它,分别统计数量

```python
#定义水像元函数
def Water(image):
    return image.select('MNDWI').gt(image.select('EVI')).Or(image.select('MNDWI').gt(image.select('NDVI'))).And(image.select('EVI').lt(0.1))

```



要求6：计算每个像元上的有效数量

```python
a = add_bands.map(Water).sum()
#计算水像元的数量
b= add_bands.count()
#计算总量
n = a.divide(b)
#计算淹没频率
n .getInfo()
```

```python
geemap.ee_export_image_to_drive(a,folder = 'Water',description = "shui",region=table.geometry(),scale = 1000,max_pixels=10000000000000.0,file_format='GeoTIFF', crs = 'EPSG:4527')
#导出水像元的图
```

```python
geemap.ee_export_image_to_drive(n,folder = 'Water',description = "yan",region=table.geometry(),scale = 250,max_pixels=10000000000000.0,file_format='GeoTIFF',crs = 'EPSG:4527')
#导出淹没频率的图
```

