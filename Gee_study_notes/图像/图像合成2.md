# 合成和Mosaicking

合成一般是指将空间上重叠的图像根据一个聚合函数组合成单个图像的过程。拼接是指对图像数据集进行空间组合，以产生空间连续图像的过程。在地球引擎中，这些术语可以互换使用，尽管合成和镶嵌都是支持的。例如，考虑在同一位置合成多个图像的任务。例如，在不同时间使用一个国家农业图像计划(NAIP)数字正射影四分之一四边形(DOQQ)，如下图所示

```python
#在相同的位置，不同的时间装载三个四分之一的NAIP。
naip2004_2012 = ee.ImageCollection('USDA/NAIP/DOQQ')
  .filterBounds(ee.Geometry.Point(-71.08841, 42.39823))
  .filterDate('2004-07-01', '2012-12-31')
  .select(['R', 'G', 'B'])

#用最大值函数对图像进行时间合成。
composite = naip2004_2012.max()
Map.setCenter(-71.12532, 42.3712, 12);
Map.addLayer(composite, {}, 'max value composite');
```

考虑一下同时镶嵌四个不同位置的doqq的需求。下面的例子演示了如何使用imageCollection.mosaic():

```python
#装载四个2012年NAIP四分之一四边形，不同的位置。
 naip2012 = ee.ImageCollection('USDA/NAIP/DOQQ')
  .filterBounds(ee.Geometry.Rectangle(-71.17965, 42.35125, -71.08824, 42.40584))
  .filterDate('2012-01-01', '2012-12-31')

#空间蒙版的图像在收集和显示。
 mosaic = naip2012.mosaic()
Map.setCenter(-71.12532, 42.3712, 12)
Map.addLayer(mosaic, {}, 'spatial mosaic')
```



注意，在前面示例中的doqq中有一些重叠。mosaic()方法将重叠的图像根据它们在集合中的顺序(最后在上面)进行合成。若要控制蒙版(或复合)中的像素源，请使用图像蒙版。例如，下面使用光谱指数的阈值来掩盖马赛克中的图像数据:

```python
#载一个四分之一的NAIP四分之一，显示。
naip = ee.Image('USDA/NAIP/DOQQ/m_4207148_nw_19_1_20120710')
Map.setCenter(-71.0915, 42.3443, 14)
Map.addLayer(naip, {}, 'NAIP DOQQ')

# 创建NDVI和NDWI光谱指数。
 ndvi = naip.normalizedDifference(['N', 'R'])
ndwi = naip.normalizedDifference(['G', 'N'])

#从索引上的阈值创建一些二值图像。
#这个阈值是用来检测裸地的。
bare1 = ndvi.lt(0.2).and(ndwi.lt(0.3)
#这种方法检测裸地的灵敏度较低。它还能检测阴影。
bare2 = ndvi.lt(0.2).and(ndwi.lt(0.8))

#定义光谱指数的可视化参数。
 ndviViz = {min: -1, max: 1, palette: ['FF0000', '00FF00']};
 ndwiViz = {min: 0.5, max: 1, palette: ['00FFFF', '0000FF']}

# 掩膜和蒙版可视化图像。最后一层在最上面。
mosaic = ee.ImageCollection([
  #NDWI > 0.5为水。用蓝色调色板可视化。
  ndwi.updateMask(ndwi.gte(0.5)).visualize(ndwiViz),
 #NDVI > 0.2为植被。用绿色调色板可视化。
  ndvi.updateMask(ndvi.gte(0.2)).visualize(ndviViz),
  #将带有阴影的裸露区域(bare2而不是bare1)可视化为灰色。
  bare2.updateMask(bare2.and(bare1.not())).visualize({palette: ['AAAAAA']}),
  # 将其他裸露的区域可视化白色。
  bare1.updateMask(bare1).visualize({palette: ['FFFFFF']}),
]).mosaic()
Map.addLayer(mosaic, {}, 'Visualization mosaic')
```

