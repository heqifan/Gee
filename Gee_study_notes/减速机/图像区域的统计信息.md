# 图像区域的统计信息

获取一个ee区域内像素值的统计信息。图像,使用image.reduceRegion()。这将区域内的所有像素减少为区域内像素数据的统计或其他紧凑表示(如直方图)。该区域被表示为一个几何图形，它可能是一个多边形，包含许多像素，或者它可能是一个点，在这种情况下，该区域将只有一个像素。在这两种情况下，如图1所示，输出是从该区域的像素导出的统计数据。



![reduceRegion diagram](https://developers.google.com/earth-engine/images/Reduce_region_diagram.png)

应用于图像和区域的减速器。

以使用reducerregion()获取图像区域的像素统计数据为例，考虑在内华达山脉针叶林边界内寻找5年Landsat复合数据的平均光谱值(如图2所示):

```javascript
//负载输入图像:Landsat 7 5年合成。
var image = ee.Image('LANDSAT/LE7_TOA_5YEAR/2008_2012');

// 加载一个输入区域:Sierra Nevada。
var region = ee.Feature(ee.FeatureCollection('EPA/Ecoregions/2013/L3')
  .filter(ee.Filter.eq('us_l3name', 'Sierra Nevada'))
  .first());

// 减少该地区。区域参数是特征几何。
var meanDictionary = image.reduceRegion({
  reducer: ee.Reducer.mean(),
  geometry: region.geometry(),
  scale: 30,
  maxPixels: 1e9
});

//结果就是一本字典。打印出来。
print(meanDictionary);
```

要强制执行计算，只需打印结果即可，代码编辑器将在控制台中显示为“Dictionary”。输出应该如下所示:

```
B1: 25.406029716816853
B2: 23.971497014238988
B3: 22.91059593763103
B4: 54.83164133293403
B5: 38.07655472573677
B6_VCID_2: 198.93216428012906
B7: 24.063261634961563
```

![reduceRegion diagram](https://developers.google.com/earth-engine/images/ReduceRegion_sierras.jpg)

图2。加州和内华达州的陆地资源卫星图像数据的假彩色合成。要缩小的区域用白色表示。

*：*注意，在本例中，减少是通过提供reducer (ee. reduce .mean())、geometry(region.geometry())、scale(30米)和maxPixels来指定输入到减少器的最大像素数。在reducereregion()调用中应该始终指定缩放。这是因为在复杂的处理流程中，可能涉及来自不同规模的不同来源的数据，输出的规模将不能从输入明确确定。在这种情况下，刻度默认为1度，这通常会产生不满意的结果。

设置尺度有两种方法:指定尺度参数，或者指定CRS和CRS变换。(有关CRS和CRS转换的更多信息，请参阅术语表)。例如，dictionaryreduction(above)的意思相当于以下内容:

```javascript
// 作为指定尺度的替代方法，指定一个CRS和一个CRS变换。
// 通过在30米处构建4326投影来制作这个阵列，
// 然后从composite.projection()复制合成的边界。
var affine = [0.00026949458523585647, 0, -180, 0, -0.00026949458523585647, 86.0000269494563];

//执行还原，打印结果。
print(image.reduceRegion({
  reducer: ee.Reducer.mean(),
  geometry: region.geometry(), 
  crs: 'EPSG:4326',
  crsTransform: affine,
  maxPixels: 1e9
}));
```

一般来说，指定规模就足够了，并且会产生可读性更强的代码。地球引擎通过先栅格化区域来决定输入哪些像素到减速器。如果指定了一个没有CRS的比例尺，该区域将在图像的本地投影中按指定的分辨率进行栅格化。如果同时指定了CRS和比例尺，则根据它们对区域进行栅格化。

## 区域内像素

根据以下规则确定像素在区域内(并加权)，并应用于指定的比例尺和投影:

**Unweighted reducers**(例如ee.Reducer.count()或ee.Reducer.mean().unweighted()):如果像素的质心在区域内且图像的掩码不为零，则包含像素。）

加权reducer(例如ee.Reducer.mean()):如果区域中至少(大约)有0.5%的像素，且图像的掩码非零，则包含像素;它们的权重是图像掩模的最小值和区域所覆盖像素的(近似)分数。

为了使计算成功，需要maxPixels参数。如果示例中没有这个参数，则会返回一个错误，它看起来类似于:

Dictionary (Error)
 Image.reduceRegion: Too many pixels in the region. Found 527001545, but only 10000000 allowed.

有多个选项可以克服这些错误:增加maxPixels(如示例中所示)，增加比例，或将bestEffort设置为true，这将自动计算一个新的(更大的)比例，从而不会超过maxPixels。如果不指定maxPixels，则使用默认值。

